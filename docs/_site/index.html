<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" >

		<link rel="stylesheet" href="/css/style.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<script src="/js/main.js"></script>

		
	</head>
	<body>
		<header>
			<h1>
			  Annopolis
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="/search/" method="get">
				<input type="text" name="q" id="search-input" placeholder="Search">
				<input type="submit" value="Search" style="display: none;">
			</form>

			<div id="sidebar" class="sidebar">
	
	
		
	
		
			<section>
				<h6>Documentation</h6>
				<ul>
					
					
						<li>
							<a href="#documentationgetting_started">
								Getting Started
								
							</a>
						</li>
					
						<li>
							<a href="#documentationenvironment">
								Environment
								
							</a>
						</li>
					
						<li>
							<a href="#documentationauthentication">
								Authentication
								
							</a>
						</li>
					
						<li>
							<a href="#documentationannotation">
								Annotation
								
							</a>
						</li>
					
						<li>
							<a href="#documentationsearch">
								Search
								
							</a>
						</li>
					
						<li>
							<a href="#documentationdependency">
								Dependency
								
							</a>
						</li>
					
				</ul>
			</section>
		
	
		
			<section>
				<h6>APIs</h6>
				<ul>
					
					
						<li>
							<a href="#apiannotations_list">
								/getAnnotationsViaList
								<span class="endpoint get"></span>
							</a>
						</li>
					
						<li>
							<a href="#apiannotation_create">
								/annotations
								<span class="endpoint post"></span>
							</a>
						</li>
					
						<li>
							<a href="#apiannotation_update">
								/annotations
								<span class="endpoint put"></span>
							</a>
						</li>
					
						<li>
							<a href="#apiannotation_delete">
								/annotations
								<span class="endpoint delete"></span>
							</a>
						</li>
					
						<li>
							<a href="#apilayers_get">
								/layers
								<span class="endpoint get"></span>
							</a>
						</li>
					
						<li>
							<a href="#apiresequenceList">
								/resequenceList
								<span class="endpoint put"></span>
							</a>
						</li>
					
						<li>
							<a href="#apiexport">
								/export
								<span class="endpoint get"></span>
							</a>
						</li>
					
						<li>
							<a href="#apiexport_check_status">
								/export/check_status
								<span class="endpoint get"></span>
							</a>
						</li>
					
						<li>
							<a href="#apiset_redis">
								/setRedisKeys
								<span class="endpoint get"></span>
							</a>
						</li>
					
						<li>
							<a href="#apiset_layers">
								/setCurrentLayers
								<span class="endpoint post"></span>
							</a>
						</li>
					
				</ul>
			</section>
		
	
		
			<section>
				<h6>Rake tasks</h6>
				<ul>
					
					
						<li>
							<a href="#taskfeed_for_search_bounding_boxes">
								feed_for_search:bounding_boxes
								
							</a>
						</li>
					
						<li>
							<a href="#taskfeed_for_search_annos_no_resource">
								feed_for_search:annos_no_resource
								
							</a>
						</li>
					
						<li>
							<a href="#taskfeed_for_search_annos_resource_only">
								feed_for_search:annos_resource_only
								
							</a>
						</li>
					
						<li>
							<a href="#taskexport_clean_s3">
								export:clean_s3
								
							</a>
						</li>
					
						<li>
							<a href="#taskdelete_chapter_from_list_annotations_maps">
								delete:chapter_from_list_annotations_maps
								
							</a>
						</li>
					
						<li>
							<a href="#taskmigrate_annotation_tags_migrate">
								migrate_annotation_tag:migrate
								
							</a>
						</li>
					
						<li>
							<a href="#tasktodo">
								TODO
								
							</a>
						</li>
					
				</ul>
			</section>
		
	
</div>


			<p class="copyright">
				<a href="https://cloudcannon.com/">
					Template by CloudCannon
				</a>
			</p>
		</header>
		<div class="main">
			

	
	

	
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="documentationgetting_started">
						Getting Started
						
					</a>
				</h3>
				

				

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="documentationenvironment">
						Environment
						
					</a>
				</h3>
				

				<h5 id="environment-variables">Environment Variables</h5>

<table>
  <tbody>
    <tr>
      <td>IIIF_HOST_URL</td>
      <td>Entity IDs will be prefixed with this URL</td>
    </tr>
    <tr>
      <td>USE_REDIS</td>
      <td>If <code class="highlighter-rouge">Y</code>, /getAnnotationsList is served from the Redis cache</td>
    </tr>
    <tr>
      <td>S3_Bucket</td>
      <td>URL of the S3 bucket to which export and search feed files are uploaded</td>
    </tr>
    <tr>
      <td>S3_Bucket_Folder</td>
      <td>Folder name under the said S3 bucket</td>
    </tr>
    <tr>
      <td>S3_Key</td>
      <td>S3 credential</td>
    </tr>
    <tr>
      <td>S3_Secret</td>
      <td>S3 credential</td>
    </tr>
    <tr>
      <td>S3_PUBLIC_DOWNLOAD_PREFIX</td>
      <td>URL prefix from which to download exported CSV files</td>
    </tr>
    <tr>
      <td>IIIF_COLLECTIONS_HOST</td>
      <td>URL of host that provides the collection information for exports</td>
    </tr>
    <tr>
      <td>USE_JWT_AUTH</td>
      <td>If ‘Y’, authenticate the REST API using JWT tokens</td>
    </tr>
  </tbody>
</table>

<p>For local development only:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>DB_HOST_DEV
DATABASE_DEV
DB_USERNAME_DEV
DB_PASSWORD_DEV
DB_HOST_TEST
DATABASE_TEST
DB_USERNAME_TEST
DB_PASSWORD_TEST
</code></pre>
</div>

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="documentationauthentication">
						Authentication
						
					</a>
				</h3>
				

				

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="documentationannotation">
						Annotation
						
					</a>
				</h3>
				

				<p>Annotations returned by the API either by themselves or embedded in a parent object,
should be in the following format.</p>

<p>The annotation server tries to keep output format close to the format of Mirador-created annotations. In the examples below,
the “Canonical” tab shows the format from the current version of Mirador. The “old” format is still supported as of Mirador v2.6.</p>

<p>The main difference is the “on” field. In the new format, “on” is an array, and the selector is of type “oa:Choice” and contains both rectagular boundary and the SVG shape. The old format has “on” as a single object and selector doesn’t contain the rectangular boundary.</p>

<div title="Canonical" class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"@id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://annotations.ten-thousand-rooms.yale.edu/annotations/e8a459bb-119c-4f46-87a3-93edc2cd22c1"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"@type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"oa:Annotation"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"@context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://iiif.io/api/presentation/2/context.json"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"@type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dctypes:Text"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text/html"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"chars"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;p&gt;Test #1&lt;/p&gt;"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"@type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"oa:Tag"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"chars"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mytag"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"within"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"http://annotations.ten-thousand-rooms.yale.edu/lists/http://manifest.tenthousandrooms.yale.edu/layers/16_http://manifest.tenthousandrooms.yale.edu/node/311/canvas/14116"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"motivation"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"oa:commenting"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"on"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"@type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"oa:SpecificResource"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"full"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://manifest.tenthousandrooms.yale.edu/node/311/canvas/14116"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"selector"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"@type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"oa:Choice"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"default"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"@type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"oa:FragmentSelector"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xywh=54,248,179,219"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"item"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"@type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"oa:SvgSelector"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;svg xmlns='http://www.w3.org/2000/svg'&gt;&lt;path xmlns=\"http://www.w3.org/2000/svg\" d=\"M53.93942,248.15395h89.65346v0h89.65346v109.58331v109.58331h-89.65346h-89.65346v-109.58331z\" data-paper-data=\"{&amp;quot;strokeWidth&amp;quot;:1,&amp;quot;rotation&amp;quot;:0,&amp;quot;deleteIcon&amp;quot;:null,&amp;quot;rotationIcon&amp;quot;:null,&amp;quot;group&amp;quot;:null,&amp;quot;editable&amp;quot;:true,&amp;quot;annotation&amp;quot;:null}\" id=\"rectangle_f95e7e02-7a2b-495e-8dc4-d47f1c0fba9d\" fill-opacity=\"0\" fill=\"#00bfff\" fill-rule=\"nonzero\" stroke=\"#00bfff\" stroke-width=\"1\" stroke-linecap=\"butt\" stroke-linejoin=\"miter\" stroke-miterlimit=\"10\" stroke-dasharray=\"\" stroke-dashoffset=\"0\" font-family=\"none\" font-weight=\"none\" font-size=\"none\" text-anchor=\"none\" style=\"mix-blend-mode: normal\"/&gt;&lt;/svg&gt;"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"within"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"@id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://manifest.tenthousandrooms.yale.edu/node/311/manifest"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"@type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sc:Manifest"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"layerId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://manifest.tenthousandrooms.yale.edu/layers/16"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<div title="Old" class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"@id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://annotations.ten-thousand-rooms.yale.edu/annotations/215bc9b4-ca41-4467-a823-4440c420eb8e"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"@type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"oa:annotation"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"@context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://iiif.io/api/presentation/2/context.json"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"@type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dctypes:Text"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text/html"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"chars"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;p&gt;《孔子集語》&amp;nbsp;&lt;/p&gt;"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"within"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"http://annotations.ten-thousand-rooms.yale.edu/lists/http://manifest.tenthousandrooms.yale.edu/layers/16_http://manifest.tenthousandrooms.yale.edu/node/311/canvas/14116"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"http://annotations.tenkr.yale.edu/annotations/lists/http://ten-thousand-rooms.herokuapp.com/layers/5557c1c3-53d5-4af5-bfc8-990008826fcc_http://manifest.tenthousandrooms.yale.edu/node/311/canvas/14116"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"motivation"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"oa:commenting"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"on"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"@type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"oa:SpecificResource"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"full"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://manifest.tenthousandrooms.yale.edu/node/311/canvas/14116"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"selector"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"@type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"oa:SvgSelector"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;svg xmlns='http://www.w3.org/2000/svg'&gt;&lt;path xmlns=\"http://www.w3.org/2000/svg\" d=\"M292.21935,122.21566l109.99409,0l109.99409,0l0,476.64106l0,476.64106l-109.99409,0l-109.99409,0l0,-476.64106z\" data-paper-data=\"{&amp;quot;rotation&amp;quot;:0,&amp;quot;annotation&amp;quot;:null}\" id=\"rectangle_647a69af-6014-412d-8c28-6e561ec82dde\" fill-opacity=\"0\" fill=\"#00bfff\" stroke=\"#00bfff\" stroke-width=\"1.74594\" stroke-linecap=\"butt\" stroke-linejoin=\"miter\" stroke-miterlimit=\"10\" stroke-dasharray=\"\" stroke-dashoffset=\"0\" font-family=\"sans-serif\" font-weight=\"normal\" font-size=\"12\" text-anchor=\"start\" mix-blend-mode=\"normal\"/&gt;&lt;/svg&gt;"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"layerId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://manifest.tenthousandrooms.yale.edu/layers/16"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>


			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="documentationsearch">
						Search
						
					</a>
				</h3>
				

				

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="documentationdependency">
						Dependency
						
					</a>
				</h3>
				

				<h4 id="getting-collection-info-for-exports">Getting collection info for exports</h4>

<div class="highlighter-rouge"><pre class="highlight"><code>${IIIF_COLLECTIONS_HOST}/node/${project_id}/collection?user_id=${user_id}
</code></pre>
</div>

<p><code class="highlighter-rouge">IIIF_COLLECTIONS_HOST</code> is an environment variable that has to be set.
For Ten Thousand Rooms project, it is the URL of the Drupal portal.</p>

			</section>

			
		</section>
	

	
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="apiannotations_list">
						/getAnnotationsViaList
						
							<span class="endpoint get"></span>
						
					</a>
				</h3>
				
					<p class="description">Get annotations on the canvas</p>
				

				<h6>Parameters</h6><dl>
  <dt>canvas_id</dt>
  <dd>ID of canvas<br />
e.g. <code class="highlighter-rouge">http://example.org/iiif/canvas/1</code><br />
(required)</dd>
</dl>

<p>Returns all annotations (along with the IDs of the layers to which they belong)
that are associated with the canvas transitively,
i.e., recursively including annotations that target those annotations, thus indirectly targeting the canvas.</p>

<div title="Response" class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"layer_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;Layer ID&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"annotation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;See Documentation/Annotation section&gt;"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
</div>

<div title="jQuery example" class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">jQuery</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">url</span><span class="p">:</span> <span class="s2">"https://mirador-annotations-lotb-stg.herokuapp.com/getAnnotationsViaList?canvas_id=http%3A%2F%2Fmanifests.ydc2.yale.edu%2FLOTB%2Fcanvas%2Fpanel_01"</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">contentType</span><span class="p">:</span> <span class="s1">'application/json; charset=utf-8'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">jqXHR</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Success'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="na">error</span><span class="p">:</span> <span class="p">(</span><span class="nx">jqXHR</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">errorThrown</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Error'</span><span class="p">,</span> <span class="nx">jqXHR</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="apiannotation_create">
						/annotations
						
							<span class="endpoint post"></span>
						
					</a>
				</h3>
				
					<p class="description">Create an annotation</p>
				

				<h6 id="payload">Payload:</h6>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nt">"layer_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;Layer ID&gt;"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"annotation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;See Documentation/Annotation section&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p class="info"><code class="highlighter-rouge">annotation["@id"]</code> is not required because it will be created by the server and included in response.</p>

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="apiannotation_update">
						/annotations
						
							<span class="endpoint put"></span>
						
					</a>
				</h3>
				
					<p class="description">Update annotation</p>
				

				<h6 id="payload">Payload:</h6>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nt">"layer_id"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"&lt;Layer ID&gt;"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nt">"annotation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;See Documentation/Annotation section&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="apiannotation_delete">
						/annotations
						
							<span class="endpoint delete"></span>
						
					</a>
				</h3>
				
					<p class="description">Delete annotation</p>
				

				<p>The whole URL of the request is identical to the IIIF style annotation ID, e.g.,
<code class="highlighter-rouge">http://annotations.ten-thousand-rooms.yale.edu/annotations/76d24e36-e255-41db-883f-64606c4ff08e</code></p>

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="apilayers_get">
						/layers
						
							<span class="endpoint get"></span>
						
					</a>
				</h3>
				
					<p class="description">Get annotation layers</p>
				

				<h6>Parameters</h6><dl>
  <dt>group_id</dt>
  <dd>Group ID of current user. <br />
When specified, returns list of layers that are defined for the group (or project).<br />
(optional - currently used for Ten Thousand Rooms only.)</dd>
</dl>

<div title="Response" class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"@context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://iiif.io/api/presentation/2/context.json"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"@id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://manifest.tenthousandrooms.yale.edu/layers/16"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"@type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sc:Layer"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Transcription"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
</div>

<div title="jQuery example" class="language-javascript highlighter-rouge"><pre class="highlight"><code></code></pre>
</div>

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="apiresequenceList">
						/resequenceList
						
							<span class="endpoint put"></span>
						
					</a>
				</h3>
				
					<p class="description">Re-order annotations in a list</p>
				

				<h6 id="payload">Payload:</h6>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nt">"canvas_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;Canvas ID&gt;"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"layer_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;Layer ID&gt;"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"annotation_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"&lt;AnnotationID&gt;"</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p class="info"><code class="highlighter-rouge">canvas_id</code> and <code class="highlighter-rouge">layer_id</code> together determines the list the user wants to change.</p>

<p class="info"><code class="highlighter-rouge">annotation_ids</code> is a list of annotation IDs that are arranged in the new updated order.</p>

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="apiexport">
						/export
						
							<span class="endpoint get"></span>
						
					</a>
				</h3>
				
					<p class="description">Export data for project</p>
				

				<h6>Parameters</h6><dl>
  <dt>user_id</dt>
  <dd>ID of user</dd>
  <dt>project_id</dt>
  <dd>ID of project</dd>
</dl>

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="apiexport_check_status">
						/export/check_status
						
							<span class="endpoint get"></span>
						
					</a>
				</h3>
				
					<p class="description">Get current status of offline export job</p>
				

				<h6>Parameters</h6><dl>
  <dt>job_id</dt>
  <dd>ID of the Delayed::Job job</dd>
</dl>

<p class="info">Used by the export page to check the progress of the offline export task.
It should initiate download when the status indicates the job is complete.</p>

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="apiset_redis">
						/setRedisKeys
						
							<span class="endpoint get"></span>
						
					</a>
				</h3>
				
					<p class="description">Export data for project</p>
				

				<h6>Parameters</h6><dl>
  <dt>canvas_id</dt>
  <dd>Canvas ID</dd>
</dl>

<p>Save all annotations associated with the canvas in Redis. <code class="highlighter-rouge">canvas_id</code> is the key.
Subsequent calls to <code class="highlighter-rouge">/getAnnotationsViaList</code> will return saved values from the Redis cache.</p>

<p class="warning">Then environment variable <code class="highlighter-rouge">USE_REDIS</code> must be set to <code class="highlighter-rouge">N</code> when this runs.</p>

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="apiset_layers">
						/setCurrentLayers
						
							<span class="endpoint post"></span>
						
					</a>
				</h3>
				

				<p>Sets layers for the group</p>

<h6 id="payload">Payload:</h6>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nt">"group_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;Group ID&gt;"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"group_description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;Description&gt;"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"layers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nt">"layer_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;Layer ID&gt;"</span><span class="p">,</span><span class="w"> </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;Label&gt;"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p class="info">Currently called from the Ten Thousand Rooms portal, for example.</p>

			</section>

			
		</section>
	

	
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="taskfeed_for_search_bounding_boxes">
						feed_for_search:bounding_boxes
						
					</a>
				</h3>
				

				<p>Calculates bounding boxes of all annotations and saves them to <code class="highlighter-rouge">annotations.service_block</code> column.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>bundle <span class="nb">exec </span>rake feed_for_search:bounding_boxes
</code></pre>
</div>

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="taskfeed_for_search_annos_no_resource">
						feed_for_search:annos_no_resource
						
					</a>
				</h3>
				

				<p>Exports annotations data to a CSV and uploads it to S3.
“Resource” data are not included</p>

<h5 id="header">Header:</h5>
<div class="highlighter-rouge"><pre class="highlight"><code>annotation_id,annotation_type,context,on,canvas,motivation,layers,bounding_box,panel,chapter,scene,display_name
</code></pre>
</div>

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="taskfeed_for_search_annos_resource_only">
						feed_for_search:annos_resource_only
						
					</a>
				</h3>
				

				<p>Exports annotations data (the resource field) to a CSV and uploads it to S3.</p>

<h5 id="header">Header:</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>annotation_id,resource_id,type,format,chars
</code></pre>
</div>

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="taskexport_clean_s3">
						export:clean_s3
						
					</a>
				</h3>
				

				<p>Delete old export files from S3.</p>

<p class="warning">Incomplete</p>

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="taskdelete_chapter_from_list_annotations_maps">
						delete:chapter_from_list_annotations_maps
						
					</a>
				</h3>
				

				<h6>Parameters</h6><dl>
  <dt>chapter</dt>
  <dd>Chapter number</dd>
</dl>

<p>For Life of the Buddha project only. Deletes all annotations and annotation/list join table entries for the given chapter.</p>

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="taskmigrate_annotation_tags_migrate">
						migrate_annotation_tag:migrate
						
					</a>
				</h3>
				

				<p>Copies tag data from Annotations to a separate table.</p>

<p class="warning">One time script after refactoring</p>

			</section>

			
		</section>
	
		<section class="doc-content">
			<section class="left-docs">
				<h3>
					<a id="tasktodo">
						TODO
						
					</a>
				</h3>
				

				<p>The following files need to be examined further to determine if they are functional, to be fixed, or obsolete.</p>

<ul>
  <li>addChapSceneSeqTags.rake</li>
  <li>checkData.rake</li>
  <li>import.rake</li>
  <li>importLotB.rake</li>
  <li>importLotBCheck.rake</li>
  <li>importLotBReload.rake</li>
  <li>importLotBReload.rake.old</li>
  <li>migrate_annotation_tags.rake</li>
  <li>rebuildAnnoStructure.rake</li>
  <li>rebuildFix.rak</li>
  <li>updateSvg.rake</li>
</ul>

			</section>

			
		</section>
	


		</div>
		<script>
			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});
		</script>
	</body>
</html>
